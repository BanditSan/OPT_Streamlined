// B9 Tank Switch for OPT Spaceplane
// Author: JadeOfMaar
// Version 0.9.0; Mar 16, 2018

// Removes dependency on Firespitter.
// OPT Night Mode currently not supported.
// Supports Snacks, TAC, CryoEngines (TAC cockpit options may need to be removed)
// Pending possible absorption of OPT_USI patch


// =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  
// New tank types
B9_TANK_TYPE:NEEDS[B9PartSwitch,SnacksUtils,!Pathfinder]
{
	name = OPTSnacks
	tankMass = 0.0003
	tankCost = 0.4
	RESOURCE
	{
		name = Snacks
		unitsPerVolume = 1
	}
	@RESOURCE[Snacks]:NEEDS[SnacksFreshAir]
	{
		@unitsPerVolume = 0.8
	}
	RESOURCE:NEEDS[SnacksFreshAir]
	{
		name = FreshAir
		unitsPerVolume = 0.2
	}
}
B9_TANK_TYPE:NEEDS[B9PartSwitch,SnacksUtils,!Pathfinder]
{
	name = OPTSoil
	tankMass = 0.0003
	tankCost = 0.5
	RESOURCE
	{
		name = Snacks
		unitsPerVolume = 0.5
	}
	RESOURCE
	{
		name = Soil
		unitsPerVolume = 0.5
		percentFilled = 0
	}
	@RESOURCE[Snacks]:NEEDS[SnacksFreshAir]
	{
		@unitsPerVolume = 0.4
	}
	@RESOURCE[Soil]:NEEDS[SnacksFreshAir]
	{
		@unitsPerVolume = 0.4
	}
	RESOURCE:NEEDS[SnacksFreshAir]
	{
		name = FreshAir
		unitsPerVolume = 0.1
	}
	RESOURCE:NEEDS[SnacksFreshAir]
	{
		name = StaleAir
		unitsPerVolume = 0.1
		percentFilled = 0
	}
}

B9_TANK_TYPE:NEEDS[B9PartSwitch,SnacksUtils,SnacksFreshAir]
{
	name = OPTSnacksAir
	tankMass = 0.0003
	tankCost = 0.4
	RESOURCE
	{
		name = FreshAir
		unitsPerVolume = 1
	}
}

// =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  
// Apply subtypes
@PART:HAS[#manufacturer[OPT*Division],@MODULE[ModuleB9PartSwitch]]:NEEDS[B9PartSwitch,SnacksUtils,!Pathfinder]
{
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[OPTcmd]]
	{
		SUBTYPE
		{
			name = OPTSnacks
			tankType = OPTSnacks
			title = Snacks
			switchInFlight = true
		}
		SUBTYPE
		{
			name = OPTSoil
			tankType = OPTSoil
			title = Soil
			switchInFlight = true
		}
		SUBTYPE
		{
			name = OPTSnacksAir
			tankType = OPTSnacksAir
			title = FreshAir
			switchInFlight = true
		}
		
	}
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[OPTcabin]]
	{
		SUBTYPE
		{
			name = OPTSnacks
			tankType = OPTSnacks
			title = Snacks
			switchInFlight = true
		}
		SUBTYPE
		{
			name = OPTSoil
			tankType = OPTSoil
			title = Soil
			switchInFlight = true
		}
		SUBTYPE
		{
			name = OPTSnacksAir
			tankType = OPTSnacksAir
			title = FreshAir
			switchInFlight = true
		}
	}
	@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[OPTcargo]]
	{
		SUBTYPE
		{
			name = OPTSnacks
			tankType = OPTSnacks
			title = Snacks
			switchInFlight = true
		}
		SUBTYPE
		{
			name = OPTSoil
			tankType = OPTSoil
			title = Soil
			switchInFlight = true
		}
		SUBTYPE
		{
			name = OPTSnacksAir
			tankType = OPTSnacksAir
			title = FreshAir
			switchInFlight = true
		}
	}
}