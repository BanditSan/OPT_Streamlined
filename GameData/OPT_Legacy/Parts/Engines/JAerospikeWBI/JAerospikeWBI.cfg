+PART[j_linear_aerospike]:NEEDS[WildBlueIndustries/FlyingSaucers]
{
	@name = j_grav_aerospike
	@title = OPT-E J Linear Gravitic Engine
	@TechRequired = wbiSaucerTechnologies
	
	!EFFECTS {}
	!MODULE[ModuleEnginesFX] {}
	!MODULE[ModuleGimbal] {}
	
	MODEL
	{
		model = OPT_Legacy/Parts/Engines/JAerospikeWBI/nucleus
		scale = 0.25, 0.25, 0.25
		// rotation = -90, 0, 0
	}
	
	EFFECTS
	{	
		//For some reason, sound only happens in one direction so this is a kludge.
		rcsSoundFX
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/UFOFlying
				volume = 0.0 0.0
				volume = 0.05 8.0
				volume = 1.0 8.0
				pitch = 0.0 0.5
				pitch = 0.25 0.5
				pitch = 1.0 1.0
				loop = true
			}
		}	
		runningRCS
		{
			MODEL_MULTI_PARTICLE
			{
				modelName = WildBlueIndustries/FlyingSaucers/FX/FlapjackRCS
				transformName = RCSthrusterFX
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}		

		running
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/UFOEngineRunning
				volume = 0.0 0.0
				volume = 1.0 0.25
				pitch = 0.0 0.4
				pitch = 0.5 0.5
				pitch = 1.0 1.0
				speed = 0.0 0.0
				speed = 0.5 0.5
				speed = 1.0 1.0
				loop = true
			}
		}
		//Just the sound
		power
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/UFOFlying
				volume = 0.0 0.0
				volume = 0.05 8.0
				volume = 1.0 8.0
				pitch = 0.0 0.5
				pitch = 0.25 0.5
				pitch = 1.0 1.0
				loop = true
			}
		}
		//These are the particle effects
		fwdThrust
		{
			MODEL_MULTI_PARTICLE
			{
				name = flame
				modelName = OPT_Legacy/PlumeParty/AerospikeGravioliumFlame
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
			MODEL_MULTI_PARTICLE
			{
				name = glitter
				modelName = OPT_Legacy/PlumeParty/AerospikeGravioliumGlitter
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		revThrust
		{
			MODEL_MULTI_PARTICLE
			{
				name = flame
				modelName = OPT_Legacy/PlumeParty/AerospikeGravioliumFlame
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
			MODEL_MULTI_PARTICLE
			{
				name = glitter
				modelName = OPT_Legacy/PlumeParty/AerospikeGravioliumGlitter
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		vtolThrust
		{
			MODEL_MULTI_PARTICLE
			{
				name = flame
				modelName = OPT_Legacy/PlumeParty/AerospikeGravioliumFlame
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
			MODEL_MULTI_PARTICLE
			{
				name = glitter
				modelName = OPT_Legacy/PlumeParty/AerospikeGravioliumGlitter
				transformName = thrustTransform
				emission = 0.0 0.0
				emission = 0.05 0.0
				emission = 0.075 0.25
				emission = 1.0 1.25
				speed = 0.0 0.5
				speed = 1.0 1.2
			}
		}
		engage
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/GeneratorStart
				volume = 0.5
				pitch = 1.0
				loop = false
			}

		}
		disengage
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/GeneratorStop
				volume = 0.5
				pitch = 1.0
				loop = false
			}

		}
		flameout
		{
			AUDIO
			{
				channel = Ship
				clip = sound_explosion_low
				volume = 1.0
				pitch = 2.0
				loop = false
			}
		}
	}
	
	MODULE
	{
		name = WBIGraviticEngine

		//Transforms. These will move around with the vessel's center of mass.
		thrustVectorTransformName = thrustTransform
		reverseTransformName = reverseThrustTransform
		vtolThrustTransformName = vtolThrustTransform

		//Always located at the center of the part.
		vtolFXTransformName = vtolThrustFX

		EngineType = Generic
		exhaustDamage = False
		heatProduction = 0
		fxOffset = 0, 0, 0
		ignitionThreshold = 0.01
		minThrust = 0

		//Maximum acceleration produced by the singularity, in meters per second per second.
		//A single engine can propel a very heavy craft but it will require more resources to do so
		//than a lighter craft.
		maxAcceleration = 20

		//The acceleration generated is affected by the throttle setting and thrust limiter
		//along with this acceleration curve.
		accelerationCurve
		{
			key = 0 0 0 0
			key = 1 1 2 2
		}

		PROPELLANT
		{
			name = GravityWaves
			resourceFlowMode = STAGE_STACK_FLOW_BALANCE
			ratio = 1
			DrawGauge = True
		}

		//Specifying a max thrust doesn't matter for the gravitic engine. It will be calculated in flight.
		//But we need a non-significant value so that KSP won't flip out when the flight scene is loaded.
		maxThrust = 100

		//ISP is important even for a gravitic engine. But we're unconcerned about atmosphere.
		atmosphereCurve
		{
			key = 0 3.456665 0 0 
			key = 1 3.456665 0 0 
		}

		//Effects
		animationName = GravEngineLights
		flameoutEffectName = flameout
		powerEffectName = power
		runningEffectName = running
		engageEffectName = engage
		disengageEffectName = disengage
		fwdThrustEffect = fwdThrust
		revThrustEffect = revThrust
		vtolThrustEffect = vtolThrust

		//Gravity Ring
		gravRingTransformName = GravLights
		gravRingSpinAxis = 0,0,1
		spinRateRPMMin = 4
		spinRateRPMMax = 12

		//How many seconds to spin up the gravity ring
		startupTime = 2.0

		//How many seconds to spin down the gravity ring
		shutdownTime = 1.0

		//Crazy Mode - Not the same as warp drive!
		crazyModeUnlocked = false //Unlocked at more advanced tech node unless in Sandbox
		crazyModeVelocity = 10000 //10km/sec
		crazyModeResource = GravityWaves
		crazyModeResourcePerSec = 250 //Should last about a second.
		crazyModeResourceReserve = 0.05 //When GravityWaves drops below 5%, stop crazy mode.

		showUpgradesInModuleInfo = true
		UPGRADES
		{
			UPGRADE
			{
				name__ = wbiCrazyMode1
				description__ = Crazy Mode Enabled.
				crazyModeUnlocked = true
			}
			UPGRADE
			{
				name__ = wbiCrazyMode2
				description__ = Crazy Mode Velocity: 20km/sec
				crazyModeVelocity = 20000
			}
		}
	}
	
	MODULE
	{
		name = WBIModuleGraviticRCS
		stagingEnabled = False
		thrusterTransformName = RCSthruster
		shieldedCanThrust = true

		//Effects
		runningEffectName = runningRCS
		rcsSoundEffectName = rcsSoundFX

		//Transform to move around to the vessel CoM
		clusterTransformName = rcsThrusterCluster

		//Computed on the fly, just like the gravitic engine,
		//but we need a value to start with to keep KSP from freaking out.
		thrusterPower = 5.0

		//Maximum acceleration that the gravitic RCS can produce
		maxAcceleration = 1.0

		//Can't use a resource with no density, so we convert
		//GravityWaves into VirtualMass.
		convertResource = GravityWaves
		convertPerSec = 1.0

		resourceName = VirtualMass
		resourceFlowMode = ALL_VESSEL
		atmosphereCurve
		{
			key = 0 1000
			key = 1 1000
		}
	}
	
	MODULE
	{
		name = ModuleConductionMultiplier
		modifiedConductionFactor = 0.003
		convectionFluxThreshold = 3000
	}
	
	
	RESOURCE
	{
		name = VirtualMass
		amount = 0
		maxAmount = 25
	}
}

+PART[opt_powersphere2]:NEEDS[WildBlueIndustries/FlyingSaucers]
{
	@name = opt_powersphere_kfs
	@title = OPT-E VS03 Power Core "Eezo"
	@description = The Gravimetric Displacement Generator is designed to zap Graviolium with ElectricCharge to produce GravityWaves which can then be used for various purposes. The process also produces StaticCharge which must be discharged from the vessel. If the craft accumulates too much StaticCharge, then the generator shuts down. The generator also has a backup RTG to serve as an auxilary power source.
	@TechRequired = wbiSaucerTechnologies
	
	EFFECTS
	{
		effectStart
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/GeneratorStart
				volume = 0.5
				pitch = 1.0
				loop = false
			}
		}

		effectStop
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/GeneratorStop
				volume = 0.5
				pitch = 1.0
				loop = false
			}
		}
		effectRunning
		{
			AUDIO
			{
				channel = Ship
				clip = WildBlueIndustries/FlyingSaucers/FX/UFOGenerator1
				volume = 0.0 0.0
				volume = 0.05 0.7
				volume = 1.0 0.5
				pitch = 0.0 0.4
				pitch = 0.05 0.5
				pitch = 1.0 1.0
				loop = true
			}
		}
	}
	
	!MODULE[ModuleResourceConverter] {}
	MODULE
	{
		name = WBIGraviticGenerator
		ConverterName = Gravity Wave Generator
		StartActionName = Start Gravity Wave Generator
		StopActionName = Stop Gravity Wave Generator
		ToggleActionName = Toggle Gravity Wave Generator
		FillAmount = 1.0
		AutoShutdown = false
		GeneratesHeat = false
		UseSpecialistBonus = false
		startEffect = effectStart
		stopEffect = effectStop
		runningEffect = effectRunning
		 
		INPUT_RESOURCE
		{
			ResourceName = Graviolium
			Ratio = 0.016875
			FlowMode = STAGE_PRIORITY_FLOW
		}
		INPUT_RESOURCE
		{
			ResourceName = ElectricCharge
			Ratio = 2500
			FlowMode = STAGE_PRIORITY_FLOW
		}
		OUTPUT_RESOURCE
		{
			ResourceName = GravityWaves
			Ratio = 120
		}
		OUTPUT_RESOURCE
		{
			ResourceName = StaticCharge
			Ratio = 0.5
			DumpExcess = false
		}
	}
	
	RESOURCE
	{
		name = GravityWaves
		amount = 0
		maxAmount = 500
	}

	RESOURCE
	{
		name = StaticCharge
		amount = 0
		maxAmount = 500
	}
}